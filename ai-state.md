# AI State (Dense)

## Repo intent
- Build staged MusicXML parser + VexFlow renderer with strict milestone discipline (`docs/planning/status.md` + `docs/planning/logs.md`).
- M0-M7 completed; M8 is active for golden-driven visual quality hardening across all LilyPond + selected real-world demos, M9 is active for engraving style-fidelity execution, and M10 is active with M10A/M10B baseline delivered and M10C/M10D fidelity tuning in progress.
- M8A baseline landed: full active LilyPond golden-reference mapping (156 fixtures) with cached PNGs and manifest checksums.
- M8B first slice landed: generalized first-column width compensation fixes opening-measure compression (`lilypond-01a-pitches-pitches`), and deterministic measure-spacing ratio tooling now reports first-vs-rest spacing consistency.
- `lilypond-01a-pitches-pitches` headless visual baseline has been refreshed post-fix (`tests/visual-headless/baselines/lilypond-01a-pitches-pitches.png`).
- M8C first slice landed: `npm run test:golden` now compares rendered output to external references using `fixtures/golden/manifest.json` + `fixtures/evaluation/golden-proofpoints.json`.
- M8C golden runner now supports deterministic system-window proof-point crops (`autoCropActual.systems`) via geometry-derived system bounds.
- Real-world proof-point `realworld-music21-bach-bwv1-6-8bars` is configured as advisory and currently fails (large mismatch), establishing baseline evidence for pagination/title/part-label gaps.
- M10 baseline is implemented in renderer:
  - paginated default with multi-page planning/output,
  - horizontal-continuous fallback,
  - page/system label/header/footer hooks.
- Latest parser/renderer regression hardening:
  - clef updates now merge by staff across measures (partial `<attributes><clef>` no longer replaces full staff-clef state),
  - clef parsing honors `clef@number` and uses source-order fallback for multiple unnumbered clefs,
  - renderer clef lookup avoids cross-staff fallback leakage and draws small mid-system clef changes,
  - parser now aggregates repeated `<notations>` blocks and preserves richer ornament payload tokens (`accidental-mark:*`, `tremolo:*`),
  - renderer category-32 mapping now attaches broader VexFlow modifiers (`Articulation`, `Ornament`, `Vibrato`, `Stroke`, `FretHandFinger`, `Tremolo`) with text fallbacks for unsupported technical tokens.
- Latest maintainability refactor:
  - split long parser modules into focused units (`parse-note-data`, `parse-note-notations`, `parse-direction-events`, `parse-measure-events`) while keeping `parse-note.ts` as the compatibility surface used by `parse.ts`,
  - split long renderer modules into focused units (`render-drawing`, `render-notations-core`, `render-notations-text`, `render-notations-spanners`, `render-note-mapper-mappings`) while keeping existing public orchestration entry points stable,
  - split conformance/eval plumbing into focused testkit modules (`conformance-types`, `conformance-report`, `conformance-quality`, `conformance-quality-geometry`, `conformance-quality-scoring`) and preserved prior report/execution interfaces via re-exports.
- Latest post-refactor regression hardening:
  - first-column spacing reservation was retuned to avoid system-start collisions while preserving MusicXML measure-width weighting behavior in source-hinted systems,
  - inter-part and intra-part vertical spacing now includes explicit ledger-heavy pitch spread pressure for better cross-staff readability in dense real-world fixtures,
  - tie/slur routing now applies stronger anchor-delta guardrails and more stable curve depth/tie-side defaults to reduce cut-through/collision artifacts,
  - direction dynamics are now rendered as SMuFL glyphs (group class `vf-dynamics-text`) instead of plain text so `f/p/mf/ffz/...` styling matches notation glyph expectations.
- Latest category-31/32 readability hardening:
  - chord-shared articulation/ornament modifiers are deduplicated before VexFlow attachment to avoid stacked duplicate symbols on chord noteheads,
  - note-specific technical text/fingering markers keep per-note anchors but compact multi-token clusters to avoid in-place label pileups,
  - direction text now uses overlap-aware row packing.
- Latest category-31/32 inspection deltas:
  - `31a-Directions` text overlaps: `13 -> 7`,
  - `32a-Notations` text overlaps: `21 -> 4`,
  - remaining warning: `NON_ARPEGGIATE_UNSUPPORTED` (tracked as `VF-GAP-002`).
- Latest quality-fallback hardening:
  - unsupported explicit duration types are skipped with diagnostics (`UNSUPPORTED_DURATION_TYPE_SKIPPED`) instead of quarter-note coercion,
  - chord-name and lyric text placement use overlap-aware row packing (zero text-overlap in current `61b`/`71g` headless checks).
- Latest dense-layout hardening:
  - dense-column minimum fitted widths were increased and a peak-local dense-rhythm pressure signal now feeds auto measures-per-system planning,
  - `lilypond-03a-rhythm-durations` now renders without barline bleed on headless inspection (`barlineIntrusions=0`, spacing bands not compressed).
- Latest grand-staff spacing hardening:
  - intra-staff gap estimation now uses stronger center-register + curved-relation weighting to reduce treble/bass collision risk in dense piano writing (Schumann-class fixtures).
- Demo page overflow hardening:
  - generated demo pages now force `overflow-x: hidden` (document + surface) to reduce horizontal blank-scroll artifacts.
- Demo viewport/readability tuning:
  - demo build path now renders with `scale=0.7` and fixed demo geometry (`1320x1800` pre-trim), then trims SVG viewports to notation-first bounds with nearby-text inclusion.
  - category labels in demo UX now include both numeric ID and title (`Category 31 - Dynamics and other single symbols`, etc.).
- CI portability hardening:
  - VexFlow gap-registry paths are now workspace-relative and validator/scripts resolve paths from current workspace (`path.resolve`), so GitHub Actions no longer depends on `/Users/mo/...` host paths.
- Headless spacing triage enhancement:
  - `npm run inspect:score` now prints per-band spacing compression telemetry (`min/max` first-vs-median ratio + compressed-band count under `<0.75`) for faster dense-layout debugging.
- Latest B-003 state (`realworld-music21-beethoven-op18no1-m1`):
  - after dense-layout tuning, spacing improved from severe to partial compression (`compressed bands 6/8 -> 1/8`, min band ratio `0.2753 -> 0.5577`, first/median ratio `~1.0994`), but one dense band is still below target.
- Latest follow-up spacing pass:
  - added grand-staff pressure into auto-wrap planning and blended density into source-width hint allocation,
  - no new regressions, but residual compression remains in Schumann (`min band ratio ~0.671`) and op18 (`compressed bands 1/8`), so both stay active M10D/M11 candidates.
- Latest M10D hardening:
  - adaptive inter-part vertical spacing based on adjacent-part complexity (`resolveInterPartGap`),
  - safer label wrap/truncation under source system margins without shrinking notation width,
  - slur side selection by endpoint skew minimization when placement is not explicit.
- Integration coverage now includes explicit paginated-option assertions (title/page-number/system-label rendering under forced multi-page layout).
- Deterministic page-background injection is now enforced (`mx-page-background`) so headless/browser screenshots do not render transparent pages as black.
- Parser now falls back to centered `<credit><credit-words>` for `metadata.workTitle` when explicit `<work><work-title>` is absent.
- Parser + renderer now honor `<print new-system="yes">` and `<print new-page="yes">` for forced system/page starts.
- Parser now preserves MusicXML `measure@width` as `sourceWidthTenths`, and renderer uses those hints to weight paginated system column widths.
- Parser now preserves MusicXML note-level `default-x` (`sourceDefaultXTenths`) and explicit `<stem>` direction (`stemDirection`) metadata for source-parity tuning.
- Parser now preserves MusicXML note-level beam markers (`beams`) for authored beam-topology reconstruction.
- Parser now also preserves defaults `system-layout/system-margins`, and paginated renderer uses them in content-width planning (instead of blindly shrinking by label-column width).
- Renderer now maps explicit source stem direction into VexFlow notes and keeps authored stem directions during automatic beam generation.
- Renderer now prefers source-authored beam groups (level-1 begin/continue/end) and falls back to automatic beam generation when source grouping is unavailable/incomplete.
- Renderer now prepares beam groups before `voice.draw()` and renders prepared beams afterward so VexFlow suppresses per-note flags for beamed notes.
- Paginated spanner drawing now applies a page measure-window filter so off-window anchors do not emit false `SPANNER_ANCHOR_NOT_RENDERED`.
- Headless visual diffing now supports optional centroid-based alignment (`alignByInkCentroid`, `maxAlignmentShift`, `alignmentAxis`) and emits alignment telemetry (`alignmentShiftX`, `alignmentShiftY`) in golden reports.
- Headless slur-anomaly detection now handles both absolute (`C`) and relative (`c`) cubic path commands, improving deterministic curve-regression detection coverage.
- Latest Bach proof-point metrics with system-window auto-crop + horizontal-only centroid alignment: `mismatchRatio=0.200641`, `ssim=0.172106`, `structuralMismatchRatio=0.635738`, `alignmentShiftX=10`, `alignmentShiftY=0` (advisory fail; still below promotion threshold).
- Latest proof-point inspection snapshot (`npm run inspect:score`):
  - `realworld-music21-bach-bwv1-6`: `flags=0`, `flagBeamOverlaps=0`, first/median spacing ratio `1.0395`.
  - `realworld-music21-beethoven-op133-longform` (page 1): `extremeCurveCount=0`.
  - `realworld-music21-beethoven-op18no1-m1` (page 1): `extremeCurveCount=0` (major diagonal cut-through resolved), but spacing ratio remains low (`0.6459`, tracked as `B-003` in planning TODO).
- M7A baseline landed: LilyPond collated-suite corpus manifest + sync script + expanded seeded demos + roadmap/corpus alignment tests.
- LilyPond roadmap semantics: `demos/lilypond/manifest.json` `categoryStatus` represents demo seeding only; conformance completion is computed from active fixture counts.
- Demo site now renders one page per active LilyPond conformance fixture (156 pages) plus selected complex real-world demos (currently 9 pages).
- M7B baseline landed: deterministic quality rubric (`Q1..Q7`) and gate enforcement integrated into conformance execution/reporting.
- Post-M7 renderer hardening landed for two high-signal defects:
  - stave-aware measure formatting (`Formatter.formatToStave`) replaced fixed-width formatting to prevent notehead/barline bleed.
  - automatic per-voice beam generation (`Beam.generateBeams`) restored missing beaming in complex real-world fixtures.
- Browser-free visual regression pipeline landed:
  - `resvg` rasterization + pixel/SSIM diff via `npm run test:visual:headless`.
  - baseline refresh via `npm run test:visual:headless:update`.
  - one-score triage via `npm run inspect:score -- --input=<path-to-score>`.

## High-signal files
- Plan/risk:
  - `/Users/mo/git/musicxml/docs/planning/status.md`
  - `/Users/mo/git/musicxml/docs/planning/logs.md`
  - `/Users/mo/git/musicxml/docs/planning/todo.md`
  - `/Users/mo/git/musicxml/docs/planning/todo.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-7.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-7A.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-7B.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-7C.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-7D.completed.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-8.md`
  - `/Users/mo/git/musicxml/docs/planning/milestone-9.md`
- `/Users/mo/git/musicxml/docs/planning/milestone-10.md`
- `/Users/mo/git/musicxml/docs/planning/milestone-11.md`
- Corpus/demo M7A:
  - `/Users/mo/git/musicxml/fixtures/corpus/lilypond-collated-v2.25.json`
  - `/Users/mo/git/musicxml/fixtures/corpus/real-world-samples.json`
  - `/Users/mo/git/musicxml/demos/lilypond/manifest.json`
  - `/Users/mo/git/musicxml/scripts/sync-lilypond-corpus.mjs`
  - `/Users/mo/git/musicxml/scripts/import-lilypond-fixtures.mjs`
  - `/Users/mo/git/musicxml/scripts/promote-lilypond-conformance.mjs`
  - `/Users/mo/git/musicxml/scripts/import-realworld-samples.mjs`
  - `/Users/mo/git/musicxml/scripts/build-demos.mjs`
  - `/Users/mo/git/musicxml/scripts/inspect-score-headless.mjs`
  - `/Users/mo/git/musicxml/scripts/run-golden-comparison.mjs`
  - `/Users/mo/git/musicxml/scripts/sync-golden-references.mjs`
  - `/Users/mo/git/musicxml/fixtures/golden/manifest.json`
  - `/Users/mo/git/musicxml/fixtures/golden/lilypond-v2.24/*.png`
  - `/Users/mo/git/musicxml/fixtures/evaluation/golden-proofpoints.json`
- Public API:
  - `/Users/mo/git/musicxml/src/public/api.ts`
- Parser core:
  - `/Users/mo/git/musicxml/src/parser/parse.ts`
  - `/Users/mo/git/musicxml/src/parser/parse-header.ts`
  - `/Users/mo/git/musicxml/src/parser/parse-note.ts`
  - `/Users/mo/git/musicxml/src/parser/parse-timewise.ts`
  - `/Users/mo/git/musicxml/src/parser/mxl.ts`
- Rendering core:
  - `/Users/mo/git/musicxml/src/vexflow/render.ts`
  - `/Users/mo/git/musicxml/src/vexflow/render-note-mapper.ts`
  - `/Users/mo/git/musicxml/src/vexflow/render-notations.ts`
- Conformance/testkit:
  - `/Users/mo/git/musicxml/src/testkit/conformance.ts`
  - `/Users/mo/git/musicxml/src/testkit/conformance-execution.ts`
  - `/Users/mo/git/musicxml/src/testkit/notation-geometry.ts`
  - `/Users/mo/git/musicxml/src/testkit/svg-collision.ts`
- Demo pipeline:
  - `/Users/mo/git/musicxml/demos/scores/*.musicxml`
  - `/Users/mo/git/musicxml/demos/lilypond/manifest.json`
  - `/Users/mo/git/musicxml/scripts/build-demos.mjs`
  - `/Users/mo/git/musicxml/scripts/serve-demos.mjs`
- Suite tips:
  - `/Users/mo/git/musicxml/docs/lilypond-suite-tips.md`
  - `/Users/mo/git/musicxml/docs/notation-style-tips.md`
  - `/Users/mo/git/musicxml/docs/headless-visual-tips.md`
  - `/Users/mo/git/musicxml/docs/evaluation-tips.md`
  - `/Users/mo/git/musicxml/docs/evaluation-runbook.md`
  - `/Users/mo/git/musicxml/docs/vexflow-gap-registry.md`
  - `/Users/mo/git/musicxml/docs/vexflow-upstream-playbook.md`
  - `/Users/mo/git/musicxml/docs/vexflow-upstream-sync-log.md`
  - `/Users/mo/git/musicxml/docs/release-hardening-checklist.md`
  - `/Users/mo/git/musicxml/docs/realworld-corpus-tips.md`

## Current conformance model
- Metadata schema: `/Users/mo/git/musicxml/fixtures/conformance/schema/conformance-fixture-meta.schema.json`
- Per fixture: `*.meta.yaml` + `*.musicxml|*.xml|*.mxl`.
- `expected` is authoritative (`pass`/`fail`), `status` gates execution (`active`/`skip`).
- `parse_mode` can override parser mode per fixture (`lenient` default, `strict` when needed).
- Optional `collision_audit` block drives overlap checks.

## M7 execution model (completed)
- `M7A` corpus comprehensiveness:
  - completed: collated-suite index sync/import parity, real-world breadth + long-form coverage gates, and malformed-source expected-fail policy are test-backed.
- `M7B` quality rubric + deterministic gates:
  - completed: formal `Q1..Q7` quality scoring dimensions, weighted summary, deterministic proxies, and gate assertions in conformance tests.
- `M7C` layered evaluation framework:
  - completed: split/gate config, layered runner (`npm run eval:run`), fail-fast classifier summaries, and artifact/report pipeline under `artifacts/evaluation/`.
- `M7D` VexFlow upstream loop:
  - completed: gap registry, validation command, upstream-brief generator, sync log, and release-hardening checklist.
  - current registry entries: `VF-GAP-001` (grace-note beaming fallback) and `VF-GAP-002` (non-arpeggiate support gap).
- `M8` golden-driven visual quality program:
  - active: deterministic geometry rule expansion, headless golden diffing, and wave-based fixture remediation.
  - completed baseline: LilyPond golden ingestion/mapping with v2.24 primary references and explicit v2.25 fallback tags where v2.24 lacks corresponding fixtures.

## Conformance execution semantics
- Implemented in `executeConformanceFixture`:
  - Compute observed outcome from actual parse/render/collision signals.
  - Compare observed vs expected.
  - `success === expectationMatched` (not raw parse success).
- Aggregate report includes diagnostic histograms:
  - `parseDiagnosticCodeHistogram`
  - `renderDiagnosticCodeHistogram`
  - `diagnosticSeverityHistogram`
- Aggregate report also includes category rollups:
  - `categoryRollups[category].{fixtureCount,passCount,failCount,...histograms}`
- Report artifact command:
  - `npm run test:conformance:report`
  - emits `artifacts/conformance/conformance-report.json|md`

## Fixture set (active baseline)
- `smoke-minimal-partwise` (`expected: pass`)
- `timewise-minimal` (`expected: pass`)
- `rhythm-backup-forward-two-voices` (`expected: pass`)
- `parser-malformed-xml` (`expected: fail`) control fixture for expected-fail gating.
- `parser-unsupported-root-opus` (`expected: fail`) unsupported MusicXML root fixture.
- `mxl-invalid-container` (`expected: fail`) malformed `.mxl` container fixture.
- `notation-invalid-pitch-step-lenient` (`expected: pass`) warning-tolerant notation fixture.
- `notation-invalid-pitch-step-strict` (`expected: fail`) strict-mode notation fixture.
- `notation-m4-baseline` (`expected: pass`) end-to-end M4 notation/direction baseline fixture.
- `layout-m5-multipart-baseline` (`expected: pass`) multi-part/multi-staff M5 layout baseline fixture.
- `text-m5-lyrics-harmony-baseline` (`expected: pass`) lyric/harmony M5 text baseline fixture.
- `advanced-m6-notation-baseline` (`expected: pass`) M6 advanced notation fixture (grace/cue/ornament/tuplet/repeat+ending).
- M7A seeded LilyPond tranche (`expected: pass`):
  - `lilypond-01a-pitches-pitches`
  - `lilypond-01c-pitches-no-voice`
  - `lilypond-02a-rests-durations`
  - `lilypond-03a-rhythm-durations`
  - `lilypond-11a-time-signatures`
  - `lilypond-13a-key-signatures`
  - `lilypond-61a-lyrics`
  - `lilypond-71g-multiple-chordnames`
- M7A tranche-2 active LilyPond categories now include:
  - `lilypond-12`, `lilypond-14`, `lilypond-21`, `lilypond-22`, `lilypond-23`
  - `lilypond-31`, `lilypond-32`, `lilypond-33`
  - `lilypond-41`, `lilypond-42`, `lilypond-43`
  - `lilypond-45`, `lilypond-46`
  - `lilypond-51`, `lilypond-52`
  - `lilypond-72`, `lilypond-73`, `lilypond-74`, `lilypond-75`
  - `lilypond-90`, `lilypond-99`
- M7A current coverage summary:
  - `lilypond` conformance fixtures: 156 active (`155 expected: pass`, `1 expected: fail`).
  - `realworld` conformance fixtures: 11 active (`11 expected: pass`).
  - total active conformance fixtures: 179 (`174 expected: pass`, `5 expected: fail`).
- M7B current quality summary (from latest `artifacts/conformance/conformance-report.json`):
  - expected-pass weighted mean: `4.8791`
  - expected-pass catastrophic readability fixtures: `0`
  - expected-pass critical collision count: `0`
  - expected-pass flag/beam overlap count: `0`
  - expected-fail LilyPond fixture: `lilypond-23c-tuplet-display-nonstandard` (explicit malformed-source waiver for undefined entity + `XML_NOT_WELL_FORMED` parse failure).
- Recently resolved M7A blocker:
  - `lilypond-24a-gracenotes` moved to `status: active`, `expected: pass` after graceful fallback handling for VexFlow grace beaming failures (`GRACE_NOTES_BEAMING_FAILED` warning path).

## Diagnostics to know
- XML/root: `XML_NOT_WELL_FORMED`, `UNSUPPORTED_ROOT`
- Timing: `BACKUP_BEFORE_MEASURE_START`, `MEASURE_CURSOR_OVERFLOW`
- Timewise: `SCORE_TIMEWISE_NORMALIZED`
- MXL: `MXL_INVALID_ARCHIVE`, `MXL_CONTAINER_*`, `MXL_SCORE_FILE_*`
- Part grouping: `PART_GROUP_STOP_WITHOUT_START`
- Notation parse/link: `UNMATCHED_*`, `UNCLOSED_*`, `WEDGE_ANCHOR_NOT_FOUND`
- Notation/text render: `SPANNER_*`, `*_RENDER_FAILED`, `WEDGE_DIRECTION_TEXT_FALLBACK`, `LYRIC_TEXT_RENDERED`, `HARMONY_TEXT_STACK_HIGH`
- Advanced notation render: `UNSUPPORTED_ORNAMENT`, `GRACE_NOTES_WITHOUT_ANCHOR`, `UNMATCHED_TUPLET_STOP`, `UNCLOSED_TUPLET_START`, `OVERLAPPING_TUPLET_START`, `TUPLET_*`, `CUE_NOTE_RENDERED`
- Layout render baseline: `MULTI_VOICE_NOT_SUPPORTED_IN_M2` still applies per staff when more than one voice targets the same staff.
- New renderer-quality diagnostics: `VOICE_FORMAT_FAILED`, `BEAM_RENDER_FAILED` (measure-overflow warning path removed because it was noisy; geometry intrusion checks are authoritative).

## Test commands
- Fast confidence loop:
  - `npm run lint`
  - `npm run typecheck`
  - `npm run test:integration`
  - `npm run test:conformance`
- Full:
  - `npm run test`
  - `npm run test:visual -- --workers=4`
- Browser-free visual:
  - `npm run test:visual:headless:update`
- `npm run test:visual:headless`
- `npm run test:golden`
- golden report now includes `structuralMismatchRatio` in addition to raw mismatch + SSIM.
- golden report now also includes `alignmentShiftX` / `alignmentShiftY` when centroid alignment is enabled.
- `npm run inspect:score -- --input=fixtures/conformance/lilypond/01a-pitches-pitches.musicxml`
- `npm run inspect:score -- --input=fixtures/conformance/realworld/realworld-music21-bach-bwv1-6.mxl`
- inspect reports now include `spacingSummary.firstToMedianOtherGapRatio` for opening-measure compression triage.
- Focused renderer-regression checks:
  - `npm run test:integration -- tests/integration/render-quality-regressions.test.ts`
  - `npm run test:integration -- tests/integration/public-api.test.ts`
  - `npm run test:integration -- tests/integration/parser-csm.test.ts`
  - `npm run test:unit -- tests/unit/notation-geometry.test.ts`
- Evaluation + upstream lifecycle:
  - `npm run eval:run`
  - `npm run vexflow:gaps:check`
  - `npm run vexflow:gaps:brief`
- M8 golden sync:
  - `npm run golden:sync`
- Demos:
  - `npm run corpus:lilypond:sync`
  - `npm run corpus:lilypond:import -- --cases 12a,14a`
  - `npm run conformance:lilypond:promote`
  - `npm run conformance:realworld:import`
  - `npm run demos:build`
  - `npm run demos:serve` (open `http://localhost:4173/` and `http://localhost:4173/lilypond-roadmap.html`)

## Playwright notes
- Browser-required tests: prefer MCP Playwright browser tool.
- Local CLI visual tests require repo-local browser path:
  - `PLAYWRIGHT_BROWSERS_PATH=/Users/mo/git/musicxml/.playwright npx playwright install chromium`
  - `PLAYWRIGHT_BROWSERS_PATH=/Users/mo/git/musicxml/.playwright npm run test:visual -- --workers=4`
- Visual sentinel spec now covers active pass fixtures across categories including M4 notation and M5 layout/text:
  - `/Users/mo/git/musicxml/tests/visual/conformance-sentinels.spec.ts`
- Sentinel spec now also includes focused regression fixtures:
  - `lilypond-01a-pitches-pitches`
  - `realworld-music21-bach-bwv1-6`
- Headless visual sentinel manifest:
  - `/Users/mo/git/musicxml/fixtures/evaluation/headless-visual-sentinels.json`
- Headless visual artifacts:
  - `/Users/mo/git/musicxml/tests/visual-headless/baselines/`
  - `/Users/mo/git/musicxml/artifacts/visual-headless/`
- Snapshot baselines live at:
  - `/Users/mo/git/musicxml/tests/visual/conformance-sentinels.spec.ts-snapshots`
  - `/Users/mo/git/musicxml/tests/visual/render-visual.spec.ts-snapshots`
- Latest run status:
  - Passing: `npm run lint`, `npm run typecheck`, `npm run test:unit`, `npm run test:integration`, `npm run test:svg`.
  - `npm run test` / `npm run test:conformance` currently hit Node OOM in this environment once large conformance suites start; targeted suites complete successfully.
- Visual status:
  - Playwright CLI launch is currently blocked in this sandbox by macOS MachPort permission errors (`bootstrap_check_in ... Permission denied (1100)`).
  - Use Playwright MCP for targeted browser checks where possible; keep deterministic headless gates as primary blockers in restricted environments.

## Next likely work (M8 + M9 + M10 execution)
- Expand notation geometry rule coverage (presence, spacing, justification, collision severity, text clearances) and integrate as blocking deterministic gates.
- Iterate golden comparison alignment/per-region metrics and expand proof-point set.
- Land paginated-default rendering API and page metadata rendering (title/labels/page numbers) for real-world PDF/image parity.
- Execute M9 proof-point workflow and style burndown waves in parallel with M8 remediation.
